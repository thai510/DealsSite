
<% @dealBuilders = DealBuilder.where(:user_id => current_user) %>

<% if current_user.deal_builders.count == 0 || @dealBuilders.empty?#make sure we have at least one deal builder created %>
<div id="leftMiddleFreeLayout">
    <div id="bigTextClickableContainer" onclick="window.location = '<%= new_deal_builder_path %>'">
      <div id="bigTextClickableText">
      Create New Offer
      </div>
    </div>
  </div>
<% else %>
<% @count = 0 %>
<% @titleLength = 33 #max length of title%>
<div id="leftMyOfferLayout">
       <% checkLiveDeals('to pass the time', 'db_index') %>

       <% @dealBuilders.reverse.each do |deal_builder| %>
         <% if @count > 6 then break end %>
         <% @count += 1 %>
         <div id="oneOfferView" onclick="window.location = '<%= deal_builder_path(deal_builder) %>'">
          <% if deal_builder.db_publish %>
            <div id='offerLiveStatusView'></div>
          <% elsif deal_builder.db_step_four %>
            <div id='offerPublishStatusView'></div>
          <% else %>
            <div id='offerIncompleteStatusView'></div>
          <% end %>
          <div id="stepsOfferViewHolder">
           <% unless deal_builder.db_publish %>
              <% unless deal_builder.db_step_four %>
                <div id="stepsOfferViewCompleted">1</div>
              <% if deal_builder.db_step_two %>
                <div id="stepsOfferViewCompleted">2</div>
              <% else %>
                <div id="stepsOfferViewNotCompleted">2</div>
              <% end %>
              <% if deal_builder.db_step_three %>
                <div id="stepsOfferViewCompleted">3</div>
              <% else %>
                <div id="stepsOfferViewNotCompleted">3</div>
              <% end %>
                <div id="stepsOfferViewNotCompleted">4</div>
              <% else %>
              PUBLISH NOW
              <% end %>
           <% else %>
          <%= deal_builder.db_publish.total_vouchers_sold %> Purchased
           <% end %>
          </div>
           <div id="stepsOfferViewHolder">
             <% if deal_builder.db_step_one.offer_title.size > @titleLength %>
                <%= deal_builder.db_step_one.offer_title[0..@titleLength] + '...'%>
             <% else %>
               <%= deal_builder.db_step_one.offer_title %>
             <% end %>
           </div>
           
         </div>
       <% end %>

  <% if @count < @dealBuilders.length %>

    <div id='restOfDealBuilders' style='display:none'>
    
      <% @restOfDBs = @dealBuilders.reverse[@count..@dealBuilders.length] %>
     <% @restOfDBs.each do |deal_builder| %>
      <div id="oneOfferView" onclick="window.location = '<%= deal_builder_path(deal_builder) %>'">
        
          <% if deal_builder.db_publish %>
            <div id='offerLiveStatusView'></div>
          <% elsif deal_builder.db_step_four %>
            <div id='offerPublishStatusView'></div>
          <% else %>
            <div id='offerIncompleteStatusView'></div>
          <% end %>
        <div id="stepsOfferViewHolder">
        <% unless deal_builder.db_publish %>
          <% unless deal_builder.db_step_four %>
            <div id="stepsOfferViewCompleted">1</div>
          <% if deal_builder.db_step_two %>
            <div id="stepsOfferViewCompleted">2</div>
          <% else %>
            <div id="stepsOfferViewNotCompleted">2</div>
          <% end %>
          <% if deal_builder.db_step_three %>
            <div id="stepsOfferViewCompleted">3</div>
          <% else %>
            <div id="stepsOfferViewNotCompleted">3</div>
          <% end %>
            <div id="stepsOfferViewNotCompleted">4</div>
          <% else %>
          PUBLISH NOW
          <% end %>
        <% else %>
          <%= deal_builder.db_publish.total_vouchers_sold %> Purchased
        <% end %>
        </div>
        <div id="stepsOfferViewHolder">
          <% if deal_builder.db_step_one.offer_title.size > @titleLength %>
             <%= deal_builder.db_step_one.offer_title[0..@titleLength] + '...'%>
           <% else %>
             <%= deal_builder.db_step_one.offer_title %>
           <% end %>
        </div>
      </div>
     <% end %>

    </div>

   <div id="moreOfferViewLink">
    VIEW ALL 
   </div>
   <div id="hideOfferViewLink" style="display:none;">
    HIDE
   </div>
  <% end %>
</div> <!-- end of leftSideLayout -->
<%end %> <!-- end of first conditional -->



<% if current_user.prev_publishes.count > 0 %>
<div class='leftSideLayout' style='display:none;'>
  <div class='blueGreenLink' style='text-align:center;'><%= link_to 'View Your Past Deals', prev_publishes_path %></div>
</div>
<% end %>
